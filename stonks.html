<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Stonks Simulatorâ„¢ FAAMG Edition</title>
<style>
  body {
    margin: 0; font-family: Arial, sans-serif;
    background-color: rgba(0,123,191,1);
    color: white;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  header {
    padding: 15px;
    background-color: rgba(0,123,191,1);
    text-align: center;
  }
  header h1 {
    margin: 0;
    font-size: 2.2em;
  }
  #stock-tabs {
    display: flex;
    background: rgba(255 255 255 / 0.1);
    padding: 8px;
    justify-content: center;
    gap: 12px;
  }
  .tab {
    padding: 8px 16px;
    border-radius: 12px;
    cursor: pointer;
    background: rgba(255 255 255 / 0.15);
    display: flex;
    align-items: center;
    gap: 6px;
    user-select: none;
    transition: background-color 0.3s;
  }
  .tab.selected {
    background: white;
    color: rgba(0,123,191,1);
    font-weight: bold;
  }
  .tab img {
    width: 24px;
    height: 24px;
  }
  #main-panel {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    padding: 15px;
    overflow: hidden;
  }
  #chart-container {
    flex-grow: 1;
    background: rgba(255 255 255 / 0.1);
    border-radius: 12px;
    padding: 12px;
    position: relative;
  }
  #canvas {
    width: 100%;
    height: 100%;
    display: block;
  }
  #controls {
    margin-top: 12px;
    display: flex;
    justify-content: center;
    gap: 20px;
  }
  #controls button {
    background: white;
    color: rgba(0,123,191,1);
    border: none;
    border-radius: 6px;
    font-weight: 600;
    padding: 8px 20px;
    cursor: pointer;
    font-size: 1.1em;
    transition: background-color 0.3s;
  }
  #controls button:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }
  #status {
    margin-top: 15px;
    font-size: 1.2em;
    text-align: center;
  }
  #portfolio {
    margin-top: 20px;
    background: rgba(255 255 255 / 0.12);
    padding: 12px 15px;
    border-radius: 10px;
    max-height: 180px;
    overflow-y: auto;
  }
  #portfolio table {
    width: 100%;
    border-collapse: collapse;
    color: white;
  }
  #portfolio th, #portfolio td {
    padding: 8px 6px;
    text-align: center;
    border-bottom: 1px solid rgba(255 255 255 / 0.2);
  }
  #portfolio th {
    font-weight: bold;
    font-size: 1em;
  }
  #passive-earnings {
    margin-top: 8px;
    font-size: 1em;
    opacity: 0.85;
    text-align: center;
  }
  @media (max-width: 720px) {
    #stock-tabs {
      flex-wrap: wrap;
      justify-content: center;
    }
    #controls {
      flex-direction: column;
      gap: 10px;
    }
    #controls button {
      width: 100%;
      font-size: 1.1em;
      padding: 10px;
    }
  }
</style>
</head>
<body>

<header>
  <h1>ðŸ’¸ Stonks Simulatorâ„¢ FAAMG Edition</h1>
  <div>Buy and sell FAAMG stocks with simulated prices. Passive earnings +$1 every 3 seconds.</div>
</header>

<div id="stock-tabs"></div>

<div id="main-panel">
  <div id="chart-container">
    <canvas id="canvas"></canvas>
  </div>

  <div id="controls">
    <button id="buyBtn">Buy</button>
    <button id="sellBtn">Sell</button>
  </div>

  <div id="status"></div>
  <div id="passive-earnings">ðŸ•’ Passive Earnings: +$1 every 3 seconds</div>

  <div id="portfolio">
    <h3>Your Portfolio</h3>
    <table>
      <thead>
        <tr>
          <th>Stock</th>
          <th>Shares Owned</th>
          <th>Total Cost ($)</th>
          <th>Current Value ($)</th>
          <th>Profit / Loss ($)</th>
        </tr>
      </thead>
      <tbody id="portfolioBody"></tbody>
    </table>
  </div>
</div>

<script>
const stocks = [
  { symbol: "META", name: "Meta", price: 183.60, logo: "https://upload.wikimedia.org/wikipedia/commons/0/05/Facebook_Logo_(2019).png" },
  { symbol: "AMZN", name: "Amazon", price: 124.88, logo: "https://upload.wikimedia.org/wikipedia/commons/a/a9/Amazon_logo.svg" },
  { symbol: "AAPL", name: "Apple", price: 174.55, logo: "https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg" },
  { symbol: "MSFT", name: "Microsoft", price: 330.28, logo: "https://upload.wikimedia.org/wikipedia/commons/4/44/Microsoft_logo.svg" },
  { symbol: "GOOGL", name: "Alphabet", price: 128.35, logo: "https://upload.wikimedia.org/wikipedia/commons/2/2f/Google_2015_logo.svg" },
];

let cash = 1000;
let currentStockIndex = 0;

// Price history: symbol -> array of candles
let priceHistory = {};
// Buy/sell history: symbol -> array of {index, type, price}
let buySellHistory = {};
// Portfolio: symbol -> { shares: int, totalCost: float }
let portfolio = {};

// Initialize histories and portfolio
function init() {
  stocks.forEach(stock => {
    priceHistory[stock.symbol] = [];
    buySellHistory[stock.symbol] = [];
    portfolio[stock.symbol] = { shares: 0, totalCost: 0 };
  });
  generateInitialCandles();
}
function generateInitialCandles() {
  stocks.forEach(stock => {
    let base = stock.price;
    for(let i=0; i<30; i++) {
      let open = base + randomBetween(-2, 2);
      let close = open + randomBetween(-3, 3);
      let high = Math.max(open, close) + randomBetween(0, 2);
      let low = Math.min(open, close) - randomBetween(0, 2);
      priceHistory[stock.symbol].push({open, high, low, close});
      base = close;
    }
  });
}

function randomBetween(min, max) {
  return Math.random() * (max - min) + min;
}

function formatMoney(num) {
  return num.toFixed(2);
}

// UI Elements
const tabsDiv = document.getElementById("stock-tabs");
const buyBtn = document.getElementById("buyBtn");
const sellBtn = document.getElementById("sellBtn");
const statusDiv = document.getElementById("status");
const portfolioBody = document.getElementById("portfolioBody");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function renderTabs() {
  tabsDiv.innerHTML = "";
  stocks.forEach((stock, i) => {
    const tab = document.createElement("div");
    tab.className = "tab" + (i === currentStockIndex ? " selected" : "");
    tab.onclick = () => {
      currentStockIndex = i;
      renderTabs();
      updateStatus();
      drawChart();
      updateButtons();
    };
    const img = document.createElement("img");
    img.src = stock.logo;
    img.alt = stock.symbol;
    const text = document.createTextNode(stock.symbol);
    tab.appendChild(img);
    tab.appendChild(text);
    tabsDiv.appendChild(tab);
  });
}

function getCurrentPrice(symbol) {
  const hist = priceHistory[symbol];
  if (!hist.length) return 0;
  return hist[hist.length-1].close;
}

function buyStock() {
  const stock = stocks[currentStockIndex];
  const price = getCurrentPrice(stock.symbol);
  if (cash >= price) {
    cash -= price;
    portfolio[stock.symbol].shares++;
    portfolio[stock.symbol].totalCost += price;
    buySellHistory[stock.symbol].push({index: priceHistory[stock.symbol].length - 1, type: "buy", price});
    updateStatus();
    updatePortfolioTable();
    updateButtons();
    drawChart();
  }
}

function sellStock() {
  const stock = stocks[currentStockIndex];
  if (portfolio[stock.symbol].shares > 0) {
    const price = getCurrentPrice(stock.symbol);
    cash += price;
    portfolio[stock.symbol].shares--;
    // Adjust total cost proportionally for simplicity (average cost)
    let avgCost = portfolio[stock.symbol].totalCost / (portfolio[stock.symbol].shares + 1);
    portfolio[stock.symbol].totalCost -= avgCost;
    buySellHistory[stock.symbol].push({index: priceHistory[stock.symbol].length - 1, type: "sell", price});
    updateStatus();
    updatePortfolioTable();
    updateButtons();
    drawChart();
  }
}

function updateStatus() {
  const stock = stocks[currentStockIndex];
  const shares = portfolio[stock.symbol].shares;
  const price = getCurrentPrice(stock.symbol);
  statusDiv.innerHTML = `
    ðŸ’° Cash: $${formatMoney(cash)}<br/>
    ðŸ“ˆ ${stock.symbol} Shares Owned: ${shares}<br/>
    ðŸ“Š Current Price: $${formatMoney(price)}
  `;
}

function updateButtons() {
  const stock = stocks[currentStockIndex];
  const price = getCurrentPrice(stock.symbol);
  buyBtn.disabled = cash < price;
  sellBtn.disabled = portfolio[stock.symbol].shares === 0;
}

// Portfolio Table
function updatePortfolioTable() {
  portfolioBody.innerHTML = "";
  stocks.forEach(stock => {
    const shares = portfolio[stock.symbol].shares;
    if (shares === 0) return; // show only owned stocks
    const avgCost = shares ? portfolio[stock.symbol].totalCost / shares : 0;
    const currentValue = shares * getCurrentPrice(stock.symbol);
    const profitLoss = currentValue - portfolio[stock.symbol].totalCost;

    const tr = document.createElement("tr");

    const tdSymbol = document.createElement("td");
    tdSymbol.textContent = stock.symbol;
    const tdShares = document.createElement("td");
    tdShares.textContent = shares;
    const tdCost = document.createElement("td");
    tdCost.textContent = formatMoney(portfolio[stock.symbol].totalCost);
    const tdValue = document.createElement("td");
    tdValue.textContent = formatMoney(currentValue);
    const tdPL = document.createElement("td");
    tdPL.textContent = (profitLoss >= 0 ? "+" : "") + formatMoney(profitLoss);
    tdPL.style.color = profitLoss >= 0 ? "lightgreen" : "#ff8080";

    tr.appendChild(tdSymbol);
    tr.appendChild(tdShares);
    tr.appendChild(tdCost);
    tr.appendChild(tdValue);
    tr.appendChild(tdPL);

    portfolioBody.appendChild(tr);
  });
}

// Candle chart drawing
function resizeCanvas() {
  canvas.width = canvas.clientWidth * devicePixelRatio;
  canvas.height = canvas.clientHeight * devicePixelRatio;
  ctx.setTransform(1, 0, 0, 1, 0, 0);
  ctx.scale(devicePixelRatio, devicePixelRatio);
}
window.addEventListener("resize", () => {
  resizeCanvas();
  drawChart();
});
resizeCanvas();

function drawChart() {
  ctx.clearRect(0, 0, canvas.clientWidth, canvas.clientHeight);

  const stock = stocks[currentStockIndex];
  const hist = priceHistory[stock.symbol];
  if (!hist.length) return;

  const width = canvas.clientWidth;
  const height = canvas.clientHeight;
  const padding = 40;
  const candleWidth = Math.min(12, (width - 2 * padding) / hist.length);
  const chartHeight = height - 2 * padding;

  let minPrice = Math.min(...hist.map(c => c.low));
  let maxPrice = Math.max(...hist.map(c => c.high));
  let pricePadding = (maxPrice - minPrice) * 0.1;
  minPrice -= pricePadding;
  maxPrice += pricePadding;

  function priceToY(price) {
    return padding + chartHeight * (1 - (price - minPrice) / (maxPrice - minPrice));
  }

  // Draw axis
  ctx.strokeStyle = "rgba(255,255,255,0.3)";
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(padding, padding);
  ctx.lineTo(padding, height - padding);
  ctx.lineTo(width - padding, height - padding);
  ctx.stroke();

  // Draw candles
  hist.forEach((candle, i) => {
    const x = padding + i * candleWidth + candleWidth / 2;

    const yOpen = priceToY(candle.open);
    const yClose = priceToY(candle.close);
    const yHigh = priceToY(candle.high);
    const yLow = priceToY(candle.low);

    const isBull = candle.close >= candle.open;
    ctx.strokeStyle = isBull ? "lime" : "red";
    ctx.fillStyle = ctx.strokeStyle;

    // Wick
    ctx.beginPath();
    ctx.moveTo(x, yHigh);
    ctx.lineTo(x, yLow);
    ctx.stroke();

    // Body
    const bodyTop = Math.min(yOpen, yClose);
    const bodyHeight = Math.max(2, Math.abs(yClose - yOpen));
    ctx.fillRect(x - candleWidth / 3, bodyTop, candleWidth / 1.5, bodyHeight);
  });

  // Draw buy/sell markers
  const markers = buySellHistory[stock.symbol];
  markers.forEach(marker => {
    const i = marker.index;
    if (i < 0 || i >= hist.length) return;
    const candle = hist[i];
    const x = padding + i * candleWidth + candleWidth / 2;
    const y = priceToY(candle.high) - 10;

    ctx.beginPath();
    if (marker.type === "buy") {
      ctx.fillStyle = "yellow";
      ctx.moveTo(x, y);
      ctx.lineTo(x - 6, y - 10);
      ctx.lineTo(x + 6, y - 10);
      ctx.closePath();
      ctx.fill();
    } else if (marker.type === "sell") {
      ctx.fillStyle = "orange";
      ctx.moveTo(x, y);
      ctx.lineTo(x - 6, y + 10);
      ctx.lineTo(x + 6, y + 10);
      ctx.closePath();
      ctx.fill();
    }
  });
}

// Simulate new candles every 5 seconds
function simulateNewCandle() {
  stocks.forEach(stock => {
    const hist = priceHistory[stock.symbol];
    const lastCandle = hist[hist.length - 1];
    let open = lastCandle.close;
    let close = open + randomBetween(-3, 3);
    let high = Math.max(open, close) + randomBetween(0, 2);
    let low = Math.min(open, close) - randomBetween(0, 2);
    hist.push({open, high, low, close});
    if(hist.length > 50) hist.shift();
  });
  renderTabs();
  drawChart();
  updateStatus();
  updateButtons();
  updatePortfolioTable();
}

// Passive earnings every 3 seconds
function passiveEarnings() {
  cash += 1;
  updateStatus();
  updateButtons();
  updatePortfolioTable();
}

buyBtn.addEventListener("click", buyStock);
sellBtn.addEventListener("click", sellStock);

init();
renderTabs();
updateStatus();
updateButtons();
updatePortfolioTable();
drawChart();

setInterval(simulateNewCandle, 5000);
setInterval(passiveEarnings, 3000);
</script>

</body>
</html>
